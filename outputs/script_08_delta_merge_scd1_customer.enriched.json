{
  "script_name": "script_08_delta_merge_scd1_customer.py",
  "dataframes": [
    {
      "df_name": "updates",
      "type": "source",
      "columns": [],
      "lineage": []
    },
    {
      "df_name": "target_path",
      "type": "intermediate",
      "columns": [],
      "lineage": []
    },
    {
      "df_name": "tgt",
      "type": "intermediate",
      "columns": [],
      "lineage": []
    },
    {
      "df_name": "spark",
      "type": "sink",
      "columns": [],
      "lineage": []
    }
  ],
  "assets": {
    "reads": [
      {
        "format": "parquet",
        "path": "s3a://my-bucket/silver/dim_customer/"
      }
    ],
    "writes": [
      {
        "format": "save",
        "path": "s3a://my-bucket/delta/dim_customer_scd1/",
        "df": "save"
      }
    ]
  },
  "bedrock_enrichment": {
    "group_by": [],
    "aggregations": [],
    "derived_columns": [],
    "joins": [
      {
        "df": "t",
        "left_df": "t",
        "right_df": "s",
        "how": "inner",
        "on": [
          "customer_id"
        ],
        "conditions": "t.customer_id = s.customer_id"
      }
    ],
    "sql_blocks": [
      {
        "name": "delta_merge_scd1_customer",
        "sql": "MERGE INTO tgt AS t USING updates AS s ON t.customer_id = s.customer_id WHEN MATCHED THEN UPDATE SET email = s.email, customer_tier = s.customer_tier, lifetime_value = s.lifetime_value, updated_at = s.updated_at, ingested_at = current_timestamp() WHEN NOT MATCHED THEN INSERT (customer_id, email, customer_tier, lifetime_value, updated_at, ingested_at) VALUES (s.customer_id, s.email, s.customer_tier, s.lifetime_value, s.updated_at, current_timestamp())",
        "tables": [
          "tgt",
          "updates"
        ],
        "columns": [
          "customer_id",
          "email",
          "customer_tier",
          "lifetime_value",
          "updated_at",
          "ingested_at"
        ]
      }
    ]
  },
  "enriched_from": {
    "script": "examples/script_08_delta_merge_scd1_customer.py",
    "base_json": "outputs/script_08_delta_merge_scd1_customer.json",
    "model_id": "amazon.nova-lite-v1:0",
    "region": "us-east-1"
  }
}