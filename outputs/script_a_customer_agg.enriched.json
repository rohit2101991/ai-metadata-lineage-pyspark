{
  "script_name": "script_a_customer_agg.py",
  "dataframes": [
    {
      "df_name": "df1",
      "type": "source",
      "columns": [],
      "lineage": []
    },
    {
      "df_name": "dfAgg",
      "type": "intermediate",
      "columns": [
        {
          "name": "big_amount",
          "derived_from": [],
          "expression": "F.col('total_amount') + F.col('total_revenue')",
          "transformation": "withColumn"
        },
        {
          "name": "customer_id",
          "derived_from": [
            "customer_id"
          ],
          "expression": "",
          "transformation": "groupByKey"
        },
        {
          "name": "product_id",
          "derived_from": [
            "product_id"
          ],
          "expression": "",
          "transformation": "groupByKey"
        },
        {
          "name": "event_date",
          "derived_from": [
            "event_date"
          ],
          "expression": "",
          "transformation": "groupByKey"
        },
        {
          "name": "total_amount",
          "derived_from": [
            "amount"
          ],
          "expression": "F.sum('amount')",
          "transformation": "aggregation"
        },
        {
          "name": "total_revenue",
          "derived_from": [
            "revenue"
          ],
          "expression": "F.sum('revenue')",
          "transformation": "aggregation"
        }
      ],
      "lineage": [
        {
          "target_col": "big_amount",
          "sources": []
        },
        {
          "target_col": "customer_id",
          "sources": [
            {
              "df": "dfAgg",
              "col": "customer_id"
            }
          ]
        },
        {
          "target_col": "product_id",
          "sources": [
            {
              "df": "dfAgg",
              "col": "product_id"
            }
          ]
        },
        {
          "target_col": "event_date",
          "sources": [
            {
              "df": "dfAgg",
              "col": "event_date"
            }
          ]
        },
        {
          "target_col": "total_amount",
          "sources": [
            {
              "df": "dfAgg",
              "col": "amount"
            }
          ]
        },
        {
          "target_col": "total_revenue",
          "sources": [
            {
              "df": "dfAgg",
              "col": "revenue"
            }
          ]
        }
      ]
    },
    {
      "df_name": "dfCurated",
      "type": "sink",
      "columns": [],
      "lineage": []
    }
  ],
  "assets": {
    "reads": [
      {
        "format": "parquet",
        "path": "s3a://mybucket/landing/customer_landing.parquet"
      }
    ],
    "writes": [
      {
        "format": "parquet",
        "path": "s3a://mybucket/curated/customer_agg/",
        "df": "parquet"
      }
    ]
  },
  "bedrock_enrichment": {
    "group_by": [
      {
        "df": "df1",
        "keys": [
          "customer_id",
          "product_id",
          "event_date"
        ]
      }
    ],
    "aggregations": [
      {
        "df": "df1",
        "expr": "sum(amount)",
        "source_cols": [
          "amount"
        ],
        "alias": "total_amount"
      },
      {
        "df": "df1",
        "expr": "sum(revenue)",
        "source_cols": [
          "revenue"
        ],
        "alias": "total_revenue"
      }
    ],
    "derived_columns": [
      {
        "df": "dfAgg",
        "col": "big_amount",
        "expression": "total_amount + total_revenue",
        "source_cols": [
          "total_amount",
          "total_revenue"
        ]
      }
    ]
  },
  "enriched_from": {
    "script": "examples/script_a_customer_agg.py",
    "base_json": "outputs/script_a_customer_agg.json",
    "model_id": "amazon.nova-lite-v1:0",
    "region": "us-east-1"
  }
}